#versi API yang didefinisikan
apiVersion: apps/v1
#jenis objek Kubernetes (statefulset)
kind: StatefulSet
#metadata untuk statefulset
metadata:
  #nama Statefulset
  name: mongodb
  #spesifikasi untuk statefulset
spec:
  #Nama Service yang digunakan oleh statefulset
  serviceName: mongo-service
  #Jumlah Replika Pod yang akan dibuat
  replicas: 1
  #Selektor untuk memilih Pod
  selector:
    #Pod yang dipilih harus memiliki label sesuai ketentuan (app:Database dan selector:mongodb)
    matchLabels:
      app: database
      selector: mongodb
  #template untuk membuat pod
  template:
    metadata:
    #Label Pod
      labels:
        app: database
        selector: mongodb
    #Spesifikasi untuk Pod
    spec:
      # Konfigurasi container dalam pod
      containers:
        # Nama container
      - name: mongodb
        # Nama image yang digunakan untuk membuat container
        image:  mongo:4.4.3
        # port yang digunakan untuk mengakses container
        ports:
        - containerPort: 27017
        #Enviroment variabel yang dibutuhkan oleh aplikasi
        env:
           # Nama environment variabel
        - name: MONGO_INITDB_ROOT_USERNAME_FILE
          # Nilai  environment variabel
          value: /etc/mongo-credentials/MONGO_ROOT_USERNAME
        - name: MONGO_INITDB_ROOT_PASSWORD_FILE
          value: /etc/mongo-credentials/MONGO_ROOT_PASSWORD
        # volume mount yang dieksekusi oleh aplikasi
        volumeMounts:
          # Volume mount dan path di dalam container yang akan digunakan untuk PersistentVolume
        - name: mongo-data
          mountPath: /data/db
        - name: mongo-config
          mountPath: /config
          #Volume mount dan path di dalam container yang akan digunakan untuk secret
        - name: mongo-credentials
          mountPath: /etc/mongo-credentials
      #volume mount yang didefinisikan pada aplikasi
      volumes:
        #Nama PersistentVolume yang akan digunakan
      - name: mongo-data
        # Nama PersistentVolumeClaim yang akan digunakan
        persistentVolumeClaim:
          claimName: mongo-pvc
        #Nama ConfigMap yang akan digunakan
      - name: mongo-config
        configMap:
          #Nama ConfigMap yang akan digunakan
          name: mongo-config
          # key dan path pada configmap yang akan digunakan
          items:
          - key: mongo.conf
            path: mongo.conf
        # Nama secret yang akan digunakan
      - name: mongo-credentials
        secret:
          # Nama secret yang akan digunakan
          secretName: mongo-credentials
          items:
            #key dan path pada secret yang akan digunakan
          - key: MONGO_ROOT_USERNAME
            path: MONGO_ROOT_USERNAME
          - key: MONGO_ROOT_PASSWORD
            path: MONGO_ROOT_PASSWORD
            